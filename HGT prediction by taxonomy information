import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler, LabelEncoder
from sklearn.linear_model import LogisticRegression
from sklearn.neighbors import KNeighborsClassifier
from sklearn.ensemble import RandomForestClassifier, AdaBoostClassifier
from sklearn.metrics import roc_curve, auc
from imblearn.under_sampling import RandomUnderSampler
import lightgbm as lgb
import xgboost as xgb
from sklearn.neural_network import MLPClassifier
from catboost import CatBoostClassifier

file_path = "your_directory_path_here"

hgt_data = pd.read_csv(f'{file_path}/combined_HGT_samples.csv', dtype={'genome1': str, 'genome2': str})
genome_data = pd.read_csv(f'{file_path}/processed_genome_data.csv')

genome_data.set_index('genome_id', inplace=True)
hgt_data['species1'] = hgt_data['genome1'].map(genome_data['species'])
hgt_data['species2'] = hgt_data['genome2'].map(genome_data['species'])

encoder = LabelEncoder()
all_species = pd.concat([hgt_data['species1'], hgt_data['species2']]).unique()
encoder.fit(all_species)
hgt_data['species1_encoded'] = encoder.transform(hgt_data['species1'])
hgt_data['species2_encoded'] = encoder.transform(hgt_data['species2'])

features = hgt_data[['species1_encoded', 'species2_encoded']]
labels = hgt_data['HGT']

X_train, X_test, y_train, y_test = train_test_split(features, labels, test_size=0.2, random_state=42)

scaler = StandardScaler()
X_train = scaler.fit_transform(X_train)
X_test = scaler.transform(X_test)

models = [
    ('Logistic Regression', LogisticRegression(random_state=42)),
    ('Random Forest', RandomForestClassifier(n_estimators=200, n_jobs=4, random_state=42, verbose=2)),
    ('KNN', KNeighborsClassifier(n_neighbors=5, n_jobs=4)),
    ('LightGBM', lgb.LGBMClassifier(n_estimators=200, random_state=42, n_jobs=4)),
    ('XGBoost', xgb.XGBClassifier(n_estimators=200, random_state=42)),
    ('Neural Network', MLPClassifier(hidden_layer_sizes=(100,), max_iter=500, random_state=42)),
    ('AdaBoost', AdaBoostClassifier(n_estimators=200, random_state=42)),
    ('CatBoost', CatBoostClassifier(iterations=200, depth=6, learning_rate=0.1, random_state=42, verbose=2))
]

plt.figure(figsize=(10, 8))

for model_name, model in models:
    print(f"Training {model_name}...")
    model.fit(X_train, y_train)
    fpr, tpr, _ = roc_curve(y_test, model.predict_proba(X_test)[:, 1])
    roc_auc = auc(fpr, tpr)
    plt.plot(fpr, tpr, lw=2, label=f'{model_name} (AUC = {roc_auc:.2f})')

plt.plot([0, 1], [0, 1], color='navy', lw=2, linestyle='--')
plt.xlim([0.0, 1.0])
plt.ylim([0.0, 1.05])
plt.xlabel('False Positive Rate')
plt.ylabel('True Positive Rate')
plt.title('Receiver Operating Characteristic (ROC) for Multiple Models')
plt.legend(loc='lower right')

plt.savefig(f'{file_path}/roc_curves_species_multiple_models.pdf')
plt.close()
